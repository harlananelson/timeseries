---
title: "R Notebook"
output: html_notebook
---

Load required packages
```{r}
library(quadprog)
library(tseries)
library(lubridate)
library(tidyverse)
```

# Time Series ARIMA Models in R
Copyright 2013 by Ani Katchova
## Read in the timeseries_ppi data
```{r}
infile <- file.path("~","time series","data","timeseries_ppi.csv")
mydata<- read_csv(infile)
names(mydata)
sapply(mydata,"class")
```
##Define the variables 
* t: convert yearqrt to a time variable
* d.Y: First difference
```{r}
d <- mydata %>%
  mutate(t = yq(yearqrt)) %>%
  mutate(Y = ppi) %>%
  mutate(d.Y = lead(Y) - Y )
```


## Descriptive statistics plots
```{r}
d %>% summary(Y)
d %>% ggplot(aes(t,Y)) + geom_line() + ggtitle("Y by Time")
d %>% ggplot(aes(t,d.Y)) + geom_line() + ggtitle("Dif of Y by Time")

```
Look at Dickey Fuller


Dickey-Fuller test for variable
```{r}
str(d)
with(d,adf.test(Y, alternative="stationary", k=0))
with(d,adf.test(Y, alternative="explosive", k=0))
with(d,summary(lm(dppi ~ lppi, na.action=na.omit)))
with(d,summary(lm(dppi ~ lppi + trend, na.action=na.omit)))


```
```{r}
with(d,adf.test(d.Y, alternative="stationary", k=0))
with(d,adf.test(d.Y, alternative="explosive", k=0))

```




```{r}

# ACF and PACF
with(d,acf(Y))
pacf(Y)
acf(d.Y)
pacf(d.Y)
# ARIMA(1,0,0) or AR(1)
arima(Y, order = c(1,0,0))
# ARIMA(2,0,0) or AR(2)
arima(Y, order = c(2,0,0))
# ARIMA(0,0,1) or MA(1)
arima(Y, order = c(0,0,1))
# ARIMA(1,0,1) or AR(1) MA(1)
arima(Y, order = c(1,0,1))
# ARIMA on differenced variable
# ARIMA(1,1,0)
arima(d.Y, order = c(1,0,0))
# ARIMA(0,1,1)
arima(d.Y, order = c(0,0,1))
# ARIMA(1,1,1)

arima(d.Y, order = c(1,0,1))
# ARIMA(1,1,3)
arima(d.Y, order = c(1,0,3))
# ARIMA(2,1,3)
arima(d.Y, order = c(2,0,3))
# ARIMA(1,0,1) forecasting
mydata.arima101 <- arima(Y, order = c(1,0,1))
mydata.pred1 <- predict(mydata.arima101, n.ahead=100)
plot (Y)
lines(mydata.pred1$pred, col="blue")
lines(mydata.pred1$pred+2*mydata.pred1$se, col="red")
lines(mydata.pred1$pred-2*mydata.pred1$se, col="red")
# ARIMA(1,1,1) forecasting
mydata.arima111 <- arima(d.Y, order = c(1,0,1))
mydata.pred1 <- predict(mydata.arima111, n.ahead=100)
plot (d.Y)
lines(mydata.pred1$pred, col="blue")
lines(mydata.pred1$pred+2*mydata.pred1$se, col="red")
lines(mydata.pred1$pred-2*mydata.pred1$se, col="red")


#> # Time Series ARIMA Models in R
#> # Copyright 2013 by Ani Katchova
#>
#> # install.packages("tseries")
#> library(tseries)
#‘tseries’ version: 0.10-32
#‘tseries’ is a package for time series analysis and computational finance.
#See ‘library(help="tseries")’ for details.
>
> mydata<- read.csv("C:/Econometrics/Data/timeseries_ppi.csv")
> attach(mydata)
>
> # Defining variables
> Y <- ppi
> d.Y <- diff(Y)
> t <- yearqrt
>
> # Descriptive statistics and plotting the data
> summary(Y)
Min. 1st Qu. Median Mean 3rd Qu. Max.
25.24 29.66 77.00 64.68 93.27 110.40
> summary(d.Y)
Min. 1st Qu. Median Mean 3rd Qu. Max.
-3.2100 0.0300 0.3000 0.4643 0.9625 3.0800
>
> plot(t,Y)
> plot(d.Y)
>
> # Dickey-Fuller test for variable
> adf.test(Y, alternative="stationary", k=0)
Augmented Dickey-Fuller Test
data: Y
Dickey-Fuller = -0.7931, Lag order = 0, p-value = 0.9604
alternative hypothesis: stationary
> adf.test(Y, alternative="explosive", k=0)
Augmented Dickey-Fuller Test
data: Y
Dickey-Fuller = -0.7931, Lag order = 0, p-value = 0.03964
alternative hypothesis: explosive
>
> summary(lm(dppi ~ lppi, na.action=na.omit))
Call:
lm(formula = dppi ~ lppi, na.action = na.omit)
Residuals:
Min 1Q Median 3Q Max
-3.6484 -0.4507 -0.1697 0.5135 2.6168
Coefficients:
Estimate Std. Error t value Pr(>|t|)
(Intercept) 0.5035691 0.1682689 2.993 0.00319 **
lppi -0.0006095 0.0023653 -0.258 0.79697
---

Signif. codes: 0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
Residual standard error: 0.9233 on 166 degrees of freedom
(1 observation deleted due to missingness)
Multiple R-squared: 0.0003999, Adjusted R-squared: -0.005622
F-statistic: 0.0664 on 1 and 166 DF, p-value: 0.797
> summary(lm(dppi ~ lppi + trend, na.action=na.omit))
Call:
lm(formula = dppi ~ lppi + trend, na.action = na.omit)
Residuals:
Min 1Q Median 3Q Max
-3.7271 -0.4264 -0.2088 0.5155 2.6533
Coefficients:
Estimate Std. Error t value Pr(>|t|)
(Intercept) 0.581139 0.197371 2.944 0.0037 **
lppi -0.008389 0.010578 -0.793 0.4289
trend 0.004957 0.006569 0.755 0.4516
---
Signif. codes: 0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
Residual standard error: 0.9245 on 165 degrees of freedom
(1 observation deleted due to missingness)
Multiple R-squared: 0.003838, Adjusted R-squared: -0.008237
F-statistic: 0.3178 on 2 and 165 DF, p-value: 0.7282
>
> # Augmented Dickey-Fuller test
> adf.test(Y, alternative="stationary")
Augmented Dickey-Fuller Test
data: Y
Dickey-Fuller = -1.3857, Lag order = 5, p-value = 0.8327
alternative hypothesis: stationary
>
> # DF and ADF tests for differenced variable
> adf.test(d.Y, k=0)
Augmented Dickey-Fuller Test
data: d.Y
Dickey-Fuller = -6.8398, Lag order = 0, p-value = 0.01
alternative hypothesis: stationary
Warning message:
In adf.test(d.Y, k = 0) : p-value smaller
```

package R 
gk package
g and h distribution

inverse g and h distribution.

1. gk distribution applied.
1. inverse g and h distribution. 

gk package 

get the confidence interval as in SAS page 63

review of the gk package  

Wensday
1: pm