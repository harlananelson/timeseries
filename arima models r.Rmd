---
title: "Replicate analysis by Ani Katchova"
output: html_notebook
---

Load required packages
```{r}
library(quadprog)
library(tseries)
library(lubridate)
library(tidyverse)
```

# Time Series ARIMA Models in R
Copyright 2013 by Ani Katchova
## Read in the timeseries_ppi data
```{r}
getwd()
infile <- file.path(getwd(),"data","timeseries_ppi.csv")
mydata<- read_csv(infile)
names(mydata)
sapply(mydata,"class")
```
##Define the variables 
* t: convert yearqrt to a time variable
* d.Y: First difference
```{r}
d <- mydata %>%
  mutate(t = yq(yearqrt)) %>%
  mutate(Y = ppi) %>%
  mutate(d.Y = lead(Y) - Y )
!is.na(d$d.Y)
# Create a version without missing differences
length(d$d.Y)
d1<-d[!is.na(d$d.Y),]
length(d1$d.Y)
```

## Descriptive statistics plots
```{r}
d %>% summary(Y)
d %>% ggplot(aes(t,Y)) + geom_line() + ggtitle("Y by Time")
d %>% ggplot(aes(t,d.Y)) + geom_line() + ggtitle("Dif of Y by Time")

```
Look at Dickey Fuller


Dickey-Fuller test for original variable
```{r}
with(d,adf.test(Y, alternative="stationary", k=0))
with(d,adf.test(Y, alternative="explosive", k=0))
```
Summary statistics
```{r}
with(d,summary(lm(dppi ~ lppi, na.action=na.omit)))
with(d,summary(lm(dppi ~ lppi + trend, na.action=na.omit)))
```

Dickey-Fuller for differenced variabler
```{r}
!is.na(d1$d.Y)
with(d1,adf.test(d.Y, alternative="stationary", k=0))
with(d1,adf.test(d.Y, alternative="explosive", k=0))

```




```{r}
# ACF and PACF
with(d,acf(Y))
with(d,pacf(Y))
with(d,acf(d.Y[!is.na(d.Y)]))
with(d,pacf(d.Y[!is.na(d.Y)]))
```
```{r}
# ARIMA(1,0,0) or AR(1)
with(d,arima(Y, order = c(1,0,0)))
```

```{r}
# ARIMA(2,0,0) or AR(2)
with(d,arima(Y, order = c(2,0,0)))
```


```{r}
# ARIMA(0,0,1) or MA(1)
with(d,arima(Y, order = c(0,0,1)))
```
```{r}
# ARIMA(1,0,1) or AR(1) MA(1)
with(d,arima(Y, order = c(1,0,1)))
```


```{r}
# ARIMA on differenced variable
# ARIMA(1,1,0)
with(d1,arima(d.Y, order = c(1,0,0)))
with(d1,arima(Y, order = c(1,1,0)))
```

```{r}
# ARIMA(0,1,1)
with(d1,arima(d.Y, order = c(0,0,1)))
```

```{r}
# ARIMA(1,1,1)
with(d1,arima(d.Y, order = c(1,0,1)))
```

```{r}
# ARIMA(1,1,3)
with(d1,arima(d.Y, order = c(1,0,3)))
```

```{r}
# ARIMA(2,1,3)
with(d1,arima(d.Y, order = c(2,0,3)))
```

```{r}
# ARIMA(1,0,1) forecasting
mydata.arima101 <- with(d1,arima(Y, order = c(1,0,1)))
mydata.pred1 <- predict(mydata.arima101, n.ahead=100)
plot (Y)
lines(mydata.pred1$pred, col="blue")
lines(mydata.pred1$pred+2*mydata.pred1$se, col="red")
lines(mydata.pred1$pred-2*mydata.pred1$se, col="red")
```

```{r}
# ARIMA(1,1,1) forecasting
mydata.arima111 <- with(d1,arima(d.Y, order = c(1,0,1)))
mydata.pred1 <- predict(mydata.arima111, n.ahead=100)
plot (d.Y)
lines(mydata.pred1$pred, col="blue")
lines(mydata.pred1$pred+2*mydata.pred1$se, col="red")
lines(mydata.pred1$pred-2*mydata.pred1$se, col="red")
```



